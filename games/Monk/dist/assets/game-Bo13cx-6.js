import{E,S as O,a as S,C as y,M as k,V as r,R as F,A as I,H as T,D as G}from"./babylon-core-ykpjuxbh.js";function A(){const e=document.getElementById("renderCanvas");if(!e)throw new Error("Render canvas not found.");const t={preserveDrawingBuffer:!0,stencil:!0};let o;try{o=new E(e,!0,{...t,disableWebGL2Support:!1})}catch{o=new E(e,!0,{...t,disableWebGL2Support:!0})}const n=new O(o);return{canvas:e,engine:o,scene:n}}function w(e,t,o,n,a){const i=k.CreateBox(t,o,e);return i.position=n,i.material=a,i.checkCollisions=!0,i}function H(e){e.collisionsEnabled=!0;const t=new S("stoneMaterial",e);t.diffuseColor=new y(.57,.55,.52);const o=new S("woodMaterial",e);o.diffuseColor=new y(.46,.34,.23);const n=new S("clothMaterial",e);n.diffuseColor=new y(.69,.61,.48);const a=k.CreateGround("ground",{width:42,height:42},e);a.material=t,a.checkCollisions=!0,w(e,"cellFloor",{width:8,depth:6,height:.5},new r(-10,.25,0),t),w(e,"hallFloor",{width:12,depth:5,height:.5},new r(-3.5,.25,0),t),w(e,"courtyardFloor",{width:20,depth:14,height:.5},new r(7,.25,0),t),w(e,"shrineFloor",{width:6,depth:6,height:.5},new r(14,.25,0),t),[{name:"cellWallWest",size:{width:.6,height:3,depth:6},pos:new r(-14,1.5,0)},{name:"cellWallNorth",size:{width:8.6,height:3,depth:.6},pos:new r(-10,1.5,-3.3)},{name:"cellWallSouth",size:{width:8.6,height:3,depth:.6},pos:new r(-10,1.5,3.3)},{name:"hallWallNorth",size:{width:12.2,height:3,depth:.6},pos:new r(-3.5,1.5,-2.8)},{name:"hallWallSouth",size:{width:12.2,height:3,depth:.6},pos:new r(-3.5,1.5,2.8)},{name:"courtyardWallNorth",size:{width:20.4,height:3,depth:.6},pos:new r(7,1.5,-7.2)},{name:"courtyardWallSouth",size:{width:20.4,height:3,depth:.6},pos:new r(7,1.5,7.2)},{name:"courtyardWallEast",size:{width:.6,height:3,depth:14.4},pos:new r(17.2,1.5,0)}].forEach(d=>{w(e,d.name,d.size,d.pos,t)}),w(e,"cellBed",{width:2.5,depth:1.2,height:.5},new r(-12,.7,1.2),o),w(e,"clothRoll",{width:1.7,depth:.7,height:.25},new r(-12,1.08,1.2),n),w(e,"altarBase",{width:2.2,depth:1.4,height:1.1},new r(14,.8,0),o);const l=w(e,"shrineMarker",{width:.9,depth:.9,height:2.1},new r(14,1.8,0),n);return l.isPickable=!1,{ground:a,shrinePosition:l.position.clone()}}const m={movement:{walkSpeed:6,sprintSpeed:9.5,acceleration:28,deceleration:20,jumpSpeed:7.2,gravity:-18,rotationLerp:10,playerHeight:1.8},camera:{distance:3.6,minDistance:1.8,maxDistance:6.5,heightOffset:2.2,mouseSensitivity:.0011,pitchMin:-.7,pitchMax:.95,followLerp:14},world:{shrineTriggerRadius:2.4}};function K(e){const t=new S("monkSkinMaterial",e);t.diffuseColor=new y(.86,.73,.58);const o=new S("monkRobeMaterial",e);o.diffuseColor=new y(.71,.42,.2);const n=new S("monkSashMaterial",e);return n.diffuseColor=new y(.6,.22,.18),{skinMaterial:t,robeMaterial:o,sashMaterial:n}}function V(e,t){const{skinMaterial:o,robeMaterial:n,sashMaterial:a}=K(t),i=k.CreateCylinder("monkRobe",{height:1.05,diameterTop:.44,diameterBottom:.72,tessellation:12},t);i.material=n,i.parent=e,i.position=new r(0,-.16,0);const l=k.CreateSphere("monkHead",{diameter:.44,segments:16},t);l.material=o,l.parent=e,l.position=new r(0,.67,0);const d=k.CreateTorus("monkSash",{diameter:.48,thickness:.08,tessellation:18},t);d.material=a,d.parent=e,d.position=new r(0,.09,0),d.rotation.x=Math.PI/2}function Y(e){const t=k.CreateCapsule("playerCapsule",{radius:.45,height:1.8,tessellation:12},e);return t.isVisible=!1,t.ellipsoid=new r(.45,.9,.45),t.ellipsoidOffset=new r(0,.9,0),t.checkCollisions=!0,t.position=new r(-11.5,1.1,0),V(t,e),t}const b=new r,v=new r,f=new r,R=new r,z=new r,J=new r(0,-1,0);function N(e,t,o){const n=Y(e),a=new r(0,0,0),i=m.movement.playerHeight/2,l=.03,d=.14,s=new F(z,J,i+.3);let c=!1;function h(){z.set(n.position.x,n.position.y+.05,n.position.z),s.length=i+.35;const u=e.pickWithRay(s,M=>M!==n&&M.checkCollisions===!0);if(!(u!=null&&u.hit)||!u.pickedPoint){c=!1;return}const g=n.position.y-i,p=u.pickedPoint.y;c=g-p<=d,c&&a.y<=0&&(a.y=0,n.position.y=p+i+l)}function C(u){const g=e.activeCamera;if(!g)return;b.copyFrom(g.getForwardRay().direction),b.y=0,b.normalize(),r.CrossToRef(r.UpReadOnly,b,v),v.normalize(),f.setAll(0),o.keys.forward&&f.addInPlace(b),o.keys.back&&f.subtractInPlace(b),o.keys.left&&f.subtractInPlace(v),o.keys.right&&f.addInPlace(v);const p=f.lengthSquared()>0;p&&f.normalize();const P=o.keys.sprint?m.movement.sprintSpeed:m.movement.walkSpeed,M=p?f.x*P:0,D=p?f.z*P:0,B=p?m.movement.acceleration:m.movement.deceleration,x=Math.min(1,B*u);if(a.x+=(M-a.x)*x,a.z+=(D-a.z)*x,h(),c&&o.consumeJumpPress()&&(a.y=m.movement.jumpSpeed,c=!1),a.y+=m.movement.gravity*u,R.set(a.x*u,a.y*u,a.z*u),n.moveWithCollisions(R),h(),p){const L=Math.atan2(f.x,f.z),W=Math.min(1,m.movement.rotationLerp*u),j=Math.atan2(Math.sin(L-n.rotation.y),Math.cos(L-n.rotation.y));n.rotation.y+=j*W}}return{mesh:n,update:C,getPosition:()=>n.position,isGrounded:()=>c}}function U(e){const t={forward:!1,back:!1,left:!1,right:!1,sprint:!1,jump:!1};let o=!1;const n=new Map([["KeyW","forward"],["KeyS","back"],["KeyA","left"],["KeyD","right"],["ShiftLeft","sprint"],["ShiftRight","sprint"]]);function a(){t.forward=!1,t.back=!1,t.left=!1,t.right=!1,t.sprint=!1,t.jump=!1,o=!1}function i(s){n.has(s.code)&&(t[n.get(s.code)]=!0),s.code==="Space"&&(s.repeat||(o=!0),t.jump=!0,s.preventDefault())}function l(s){n.has(s.code)&&(t[n.get(s.code)]=!1),s.code==="Space"&&(t.jump=!1,s.preventDefault())}function d(){a()}return window.addEventListener("keydown",i),window.addEventListener("keyup",l),window.addEventListener("blur",d),e.setAttribute("tabindex","0"),{keys:t,consumeJumpPress(){const s=o;return o=!1,s},dispose(){window.removeEventListener("keydown",i),window.removeEventListener("keyup",l),window.removeEventListener("blur",d),a()}}}function q(e,t,o){const n=m.camera,a=new r,i=new I("playerCamera",Math.PI*1.4,1.1,n.distance,o.getPosition(),e);i.attachControl(t,!0),i.lowerBetaLimit=n.pitchMin+Math.PI/2,i.upperBetaLimit=n.pitchMax+Math.PI/2,i.lowerRadiusLimit=n.minDistance,i.upperRadiusLimit=n.maxDistance,i.wheelDeltaPercentage=.01,i.angularSensibilityX=1/n.mouseSensitivity,i.angularSensibilityY=1/n.mouseSensitivity,i.checkCollisions=!0,i.collisionRadius=new r(.4,.4,.4),e.activeCamera=i;function l(){var s;document.pointerLockElement!==t&&((s=t.requestPointerLock)==null||s.call(t))}function d(s){const c=o.getPosition();a.set(c.x,c.y+n.heightOffset,c.z);const h=Math.min(1,n.followLerp*s);i.target=r.Lerp(i.target,a,h)}return{camera:i,activatePointerLock:l,update:d}}function X(){const e=document.getElementById("startScreen"),t=document.getElementById("playButton"),o=document.getElementById("hud"),n=document.getElementById("objectiveText"),a=document.getElementById("storyBox");let i=!1;function l(h){i||(i=!0,setTimeout(()=>{e.classList.remove("visible"),o.classList.remove("hidden"),h==null||h()},120))}function d(h){t.addEventListener("click",()=>l(h))}function s(h){a.textContent=h,a.classList.remove("hidden")}function c(h){n.textContent=`Objective: ${h}`}return{bindStart:d,showStory:s,setObjective:c,isPlaying:()=>i}}function $(e,t,o){let n=!1;function a(){if(n)return;const i=t.getPosition();r.Distance(i,e.shrinePosition)<=m.world.shrineTriggerRadius&&(n=!0,o.showStory("A distant bell rings. Something calls you beyond the monastery."),o.setObjective("Prototype complete"))}return{update:a,isShrineTriggered:()=>n}}function Z(){const e=document.createElement("div");return e.style.position="fixed",e.style.right="12px",e.style.top="10px",e.style.padding="4px 8px",e.style.fontSize="12px",e.style.background="rgba(0,0,0,0.4)",e.style.border="1px solid rgba(255,255,255,0.15)",e.style.borderRadius="4px",e.style.color="#d8dde9",e.style.pointerEvents="none",e.textContent="FPS: --",document.body.appendChild(e),{update(t){e.textContent=`FPS: ${Math.round(t)}`}}}function _(){const{canvas:e,engine:t,scene:o}=A();o.clearColor.set(.56,.62,.72,1);const n=new T("hemiLight",new r(0,1,0),o);n.intensity=.68,n.groundColor=new y(.26,.22,.16);const a=new G("sunLight",new r(-.4,-1,.35),o);a.intensity=1.6,a.position=new r(15,30,-10);const i=H(o),l=U(e),d=N(o,i,l),s=q(o,e,d),c=X(),h=$(i,d,c),C=Z();c.bindStart(()=>{e.focus(),s.activatePointerLock()}),o.onBeforeRenderObservable.add(()=>{if(!c.isPlaying())return;const p=o.getEngine().getDeltaTime()/1e3;d.update(p),s.update(p),h.update(),C.update(o.getEngine().getFps())}),t.runRenderLoop(()=>{o.render()}),window.addEventListener("resize",()=>{t.resize()});let u=!1;const g=()=>{var p;u||(u=!0,(p=l.dispose)==null||p.call(l))};o.onDisposeObservable.add(g),window.addEventListener("beforeunload",g,{once:!0})}export{_ as createGame};

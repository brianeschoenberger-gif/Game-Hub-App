import{E as V,S as Q,a as T,C as k,M as P,V as a,A as R,b as z,c as y,R as Z,d as ee,H as te,D as ne}from"./babylon-core-CpL_ofxJ.js";function ie(){const t=document.getElementById("renderCanvas");if(!t)throw new Error("Render canvas not found.");const e={preserveDrawingBuffer:!0,stencil:!0};let i;try{i=new V(t,!0,{...e,disableWebGL2Support:!1})}catch{i=new V(t,!0,{...e,disableWebGL2Support:!0})}const n=new Q(i);return{canvas:t,engine:i,scene:n}}function m(t,e,i,n,l){const o=P.CreateBox(e,i,t);return o.position=n,o.material=l,o.checkCollisions=!0,o}function j(t,e,i){e.forEach(n=>{m(t,n.name,n.size,n.pos,i)})}function B(t,e,i){const o=e.width/2,s=e.depth/2;j(t,[{name:`${e.name}WallNorth`,size:{width:e.width+.6,height:3,depth:.6},pos:new a(e.center.x,3/2,e.center.z-s)},{name:`${e.name}WallSouth`,size:{width:e.width+.6,height:3,depth:.6},pos:new a(e.center.x,3/2,e.center.z+s)},{name:`${e.name}WallWest`,size:{width:.6,height:3,depth:e.depth+.6},pos:new a(e.center.x-o,3/2,e.center.z)},{name:`${e.name}WallEast`,size:{width:.6,height:3,depth:e.depth+.6},pos:new a(e.center.x+o,3/2,e.center.z)}],i)}function oe(t){t.collisionsEnabled=!0;const e=new T("stoneMaterial",t);e.diffuseColor=new k(.57,.55,.52);const i=new T("woodMaterial",t);i.diffuseColor=new k(.46,.34,.23);const n=new T("clothMaterial",t);n.diffuseColor=new k(.69,.61,.48);const l=new T("gardenMaterial",t);l.diffuseColor=new k(.35,.43,.33);const o=new T("waterMaterial",t);o.diffuseColor=new k(.35,.53,.62);const s=P.CreateGround("ground",{width:78,height:58},t);s.material=e,s.checkCollisions=!0,B(t,{name:"northCellA",center:new a(-30,0,-13),width:8,depth:8},e),B(t,{name:"northCellB",center:new a(-21,0,-13),width:8,depth:8},e),B(t,{name:"kitchen",center:new a(-30,0,2),width:8,depth:8},e),B(t,{name:"startCell",center:new a(-21,0,2),width:8,depth:8},e);const r=m(t,"courtyardFloor",{width:31,depth:26,height:.5},new a(-1,.25,-4),l);r.checkCollisions=!1,m(t,"northArchWall",{width:15,depth:.6,height:4},new a(-1,2,-17),e),m(t,"northArchPillarLeft",{width:.9,depth:.9,height:4},new a(-8.2,2,-17),e),m(t,"northArchPillarRight",{width:.9,depth:.9,height:4},new a(6.2,2,-17),e),m(t,"bookshelfUpper",{width:14,depth:.8,height:1.6},new a(-14.5,.8,-17),i),m(t,"bookshelfLower",{width:14,depth:.8,height:1.6},new a(-14.5,.8,6),i),m(t,"northBedAFrame",{width:2.5,depth:1.4,height:.55},new a(-31,.72,-14.8),i),m(t,"northBedAMat",{width:1.8,depth:1,height:.2},new a(-31,1.08,-14.8),n),m(t,"northBedBFrame",{width:2.5,depth:1.4,height:.55},new a(-22,.72,-14.8),i),m(t,"northBedBMat",{width:1.8,depth:1,height:.2},new a(-22,1.08,-14.8),n),m(t,"startBedFrame",{width:2.5,depth:1.4,height:.55},new a(-22,.72,3.8),i),m(t,"startBedMat",{width:1.8,depth:1,height:.2},new a(-22,1.08,3.8),n),m(t,"statueBase",{width:3,depth:2,height:1},new a(-7,.6,-4),e);const c=m(t,"shrineMarker",{width:.9,depth:.9,height:2.2},new a(-7,1.8,-4),n);c.isPickable=!1;const h=P.CreateCylinder("fountain",{height:.9,diameter:6,tessellation:28},t);h.position=new a(4.5,.45,-4),h.material=o,h.checkCollisions=!0;const d=[{name:"eastTopOuterNorth",size:{width:16,height:3,depth:.6},pos:new a(23,1.5,-17)},{name:"eastTopOuterSouth",size:{width:16,height:3,depth:.6},pos:new a(23,1.5,-6.5)},{name:"eastTopOuterEast",size:{width:.6,height:3,depth:10.5},pos:new a(31,1.5,-11.8)},{name:"eastTopOuterWestA",size:{width:.6,height:3,depth:4},pos:new a(15,1.5,-15)},{name:"eastTopOuterWestB",size:{width:.6,height:3,depth:4.5},pos:new a(15,1.5,-8.8)},{name:"eastTopMazeA",size:{width:6,height:3,depth:.6},pos:new a(20,1.5,-13.2)},{name:"eastTopMazeB",size:{width:.6,height:3,depth:5},pos:new a(24,1.5,-14.5)},{name:"eastTopMazeC",size:{width:4.2,height:3,depth:.6},pos:new a(26.8,1.5,-10.6)},{name:"eastTopMazeD",size:{width:.6,height:3,depth:4},pos:new a(19.2,1.5,-9.5)}];j(t,d,e);const b=[{name:"eastBottomOuterNorth",size:{width:16,height:3,depth:.6},pos:new a(23,1.5,6.5)},{name:"eastBottomOuterSouth",size:{width:16,height:3,depth:.6},pos:new a(23,1.5,22)},{name:"eastBottomOuterWest",size:{width:.6,height:3,depth:15.5},pos:new a(15,1.5,14.2)},{name:"eastBottomOuterEastA",size:{width:.6,height:3,depth:5.5},pos:new a(31,1.5,9.2)},{name:"eastBottomOuterEastB",size:{width:.6,height:3,depth:8},pos:new a(31,1.5,18)},{name:"eastBottomMazeA",size:{width:9.6,height:3,depth:.6},pos:new a(21.4,1.5,11.5)},{name:"eastBottomMazeB",size:{width:.6,height:3,depth:7},pos:new a(19,1.5,16.8)},{name:"eastBottomMazeC",size:{width:4.5,height:3,depth:.6},pos:new a(27.7,1.5,14.6)},{name:"eastBottomMazeD",size:{width:.6,height:3,depth:6},pos:new a(26,1.5,18.9)}];j(t,b,e),m(t,"southBlockWest",{width:17,depth:11,height:3},new a(-13,1.5,18),e),m(t,"southBlockCenter",{width:10,depth:11,height:3},new a(2.5,1.5,18),e),m(t,"mapBoundaryWest",{width:.6,depth:48,height:3},new a(-34.8,1.5,3),e),m(t,"mapBoundaryNorth",{width:48,depth:.6,height:3},new a(-10.5,1.5,-20.5),e),m(t,"mapBoundarySouth",{width:66,depth:.6,height:3},new a(-2,1.5,24.2),e);const p=new T("gateMaterial",t);p.diffuseColor=new k(.38,.26,.16);const g=m(t,"monasteryGateFrame",{width:6,depth:.8,height:4.6},new a(13.5,2.3,-4),e);g.checkCollisions=!1;const C=m(t,"monasteryGateOpening",{width:4.1,depth:.82,height:3.2},new a(13.5,1.6,-4),l);C.isVisible=!1,C.checkCollisions=!1;const f=m(t,"monasteryGateDoorLeft",{width:1.7,depth:.45,height:2.9},new a(12.35,1.45,-4),p),u=m(t,"monasteryGateDoorRight",{width:1.7,depth:.45,height:2.9},new a(14.65,1.45,-4),p);f.checkCollisions=!1,u.checkCollisions=!1;const M=m(t,"exteriorPath",{width:22,depth:8,height:.45},new a(24.5,.18,-4),n);M.checkCollisions=!1;const A=m(t,"exteriorRidge",{width:28,depth:4,height:1.8},new a(31,.9,-11),e);A.checkCollisions=!1;const v=P.CreateCylinder("incenseBowl",{height:.45,diameterTop:.85,diameterBottom:.55,tessellation:24},t);v.position=new a(-9.6,.9,-1.6),v.material=i,v.checkCollisions=!1;const S=P.CreateSphere("incenseFlame",{diameter:.22,segments:12},t);return S.material=n,S.isVisible=!1,S.checkCollisions=!1,{ground:s,shrinePosition:c.position.clone(),gatePosition:new a(13.5,0,-4),interactablePosition:v.position.clone(),interactableFlame:S}}const w={movement:{walkSpeed:5.8,sprintSpeed:8.8,acceleration:24,deceleration:16,airAcceleration:7,jumpSpeed:7.6,gravity:-19,fallGravityMultiplier:1.22,lowJumpGravityMultiplier:1.1,coyoteTime:.08,jumpBufferTime:.12,rotationLerp:11,playerHeight:1.8,spawnPosition:{x:-22,y:1.1,z:1.8}},camera:{distance:3.4,minDistance:1.7,maxDistance:6.5,heightOffset:2.2,mouseSensitivity:.0011,pitchMin:-.7,pitchMax:.95,followLerp:12,lookAheadDistance:.9,lookAheadLerp:6,cameraRotationFollowLerp:5,cameraRotationMoveThreshold:.25,collisionRadius:.34,inertia:.62},effects:{dustMotes:{count:24,radius:20,minHeight:.7,maxHeight:3.4,driftSpeed:.18,bobAmplitude:.14,size:.055}},audio:{ambientVolume:.06,bellVolume:.2},world:{shrineTriggerRadius:2.4,gateTriggerRadius:2.8,interactRange:2.2,checkpointResetCooldown:.35}},D={idle:["idle","breath","stand"],run:["run","walk","jog"],jump:["jump","fall"]};function F(t,e){const i=e.map(n=>n.toLowerCase());return t.find(n=>{var o;const l=((o=n.name)==null?void 0:o.toLowerCase())??"";return i.some(s=>l.includes(s))})??null}function ae(t){if(!t)return null;const e=t.clone("jumpProxyGroup");return e.speedRatio=.7,e.stop(),e}function se(t=[]){const e=F(t,D.idle),i=F(t,D.run),n=F(t,D.jump)??ae(i),l={idle:e,run:i,jump:n},o={idle:0,run:0,jump:0};let s="idle",r=!1;Object.values(l).forEach(d=>{!d||!(d instanceof R)||(d.play(!0),d.setWeightForAllAnimatables(0),d.enableBlending=!0,d.blendingSpeed=.08,r=!0)}),r&&l.idle&&(o.idle=1,l.idle.setWeightForAllAnimatables(1));function c(d){r&&(s=d)}function h(d,b){if(!r)return;const p={idle:s==="idle"?1:0,run:s==="run"?1:0,jump:s==="jump"?1:0},g=z.Clamp(d*10,0,1);l.idle&&(o.idle=z.Lerp(o.idle,p.idle,g),l.idle.setWeightForAllAnimatables(o.idle)),l.run&&(o.run=z.Lerp(o.run,p.run,g),l.run.speedRatio=z.Lerp(.9,1.35,z.Clamp(b.normalizedSpeed,0,1)),l.run.setWeightForAllAnimatables(o.run)),l.jump&&(o.jump=z.Lerp(o.jump,p.jump,g),l.jump.setWeightForAllAnimatables(o.jump))}return{isReady:()=>r,setState:c,update:h}}function re(t,e){const i=new T("monkSkinMaterial",e);i.diffuseColor=new k(.86,.73,.58);const n=new T("monkRobeMaterial",e);n.diffuseColor=new k(.71,.42,.2);const l=new T("monkSashMaterial",e);l.diffuseColor=new k(.6,.22,.18);const o=P.CreateBox("monkRoot",{size:.01},e);o.parent=t,o.position=new a(0,-.1,0),o.isVisible=!1;const s=P.CreateCylinder("monkRobe",{height:1.14,diameterTop:.42,diameterBottom:.76,tessellation:18},e);s.material=n,s.parent=o,s.position=new a(0,.32,0);const r=P.CreateSphere("monkHead",{diameter:.42,segments:20},e);r.material=i,r.parent=o,r.position=new a(0,1.05,0);const c=P.CreateTorus("monkSash",{diameter:.5,thickness:.08,tessellation:24},e);c.material=l,c.parent=o,c.position=new a(0,.45,0),c.rotation.x=Math.PI/2;const h=P.CreateCapsule("monkArmLeft",{radius:.08,height:.65,tessellation:12},e);h.material=n,h.parent=o,h.position=new a(-.28,.63,0),h.rotation.z=.22;const d=P.CreateCapsule("monkArmRight",{radius:.08,height:.65,tessellation:12},e);return d.material=n,d.parent=o,d.position=new a(.28,.63,0),d.rotation.z=-.22,{root:o,armLeft:h,armRight:d}}function le(t,e){const i=new y("idle-bob","position.y",30,y.ANIMATIONTYPE_FLOAT,y.ANIMATIONLOOPMODE_CYCLE);i.setKeys([{frame:0,value:e.root.position.y},{frame:15,value:e.root.position.y+.03},{frame:30,value:e.root.position.y}]);const n=new y("run-bob","position.y",30,y.ANIMATIONTYPE_FLOAT,y.ANIMATIONLOOPMODE_CYCLE);n.setKeys([{frame:0,value:e.root.position.y-.04},{frame:8,value:e.root.position.y+.06},{frame:15,value:e.root.position.y-.04},{frame:22,value:e.root.position.y+.06},{frame:30,value:e.root.position.y-.04}]);const l=new y("run-arm-left","rotation.x",30,y.ANIMATIONTYPE_FLOAT,y.ANIMATIONLOOPMODE_CYCLE);l.setKeys([{frame:0,value:-.6},{frame:15,value:.6},{frame:30,value:-.6}]);const o=new y("run-arm-right","rotation.x",30,y.ANIMATIONTYPE_FLOAT,y.ANIMATIONLOOPMODE_CYCLE);o.setKeys([{frame:0,value:.6},{frame:15,value:-.6},{frame:30,value:.6}]);const s=new y("jump-lift","position.y",30,y.ANIMATIONTYPE_FLOAT,y.ANIMATIONLOOPMODE_CYCLE);s.setKeys([{frame:0,value:e.root.position.y},{frame:12,value:e.root.position.y+.24},{frame:22,value:e.root.position.y+.16},{frame:30,value:e.root.position.y}]);const r=new y("jump-arms","rotation.x",30,y.ANIMATIONTYPE_FLOAT,y.ANIMATIONLOOPMODE_CYCLE);r.setKeys([{frame:0,value:0},{frame:12,value:-.8},{frame:30,value:0}]);const c=new R("idle");c.addTargetedAnimation(i,e.root);const h=new R("run");h.addTargetedAnimation(n,e.root),h.addTargetedAnimation(l,e.armLeft),h.addTargetedAnimation(o,e.armRight);const d=new R("jump");return d.addTargetedAnimation(s,e.root),d.addTargetedAnimation(r,e.armLeft),d.addTargetedAnimation(r.clone(),e.armRight),[c,h,d]}async function de(t,e){const i=re(t,e),n=le(e,i),l=se(n);return{setAnimationState:l.setState,update:(o,s)=>l.update(o,s),loadedFromGlb:!1}}function he(t){const e=P.CreateCapsule("playerCapsule",{radius:.45,height:1.8,tessellation:12},t);e.isVisible=!1,e.ellipsoid=new a(.45,.9,.45),e.ellipsoidOffset=new a(0,.9,0),e.checkCollisions=!0;const i=w.movement.spawnPosition;return e.position=new a(i.x,i.y,i.z),e}async function ce(t,e){return de(t,e)}const x=new a,E=new a,L=new a,Y=new a,K=new a,ue=new a(0,-1,0),_=new a(0,0,1);function pe(t,e,i){const n=he(t),l={setAnimationState:()=>{},update:()=>{},loadedFromGlb:!1};ce(n,t).then(u=>{l.setAnimationState=u.setAnimationState,l.update=u.update,l.loadedFromGlb=u.loadedFromGlb});const o=new a(0,0,0),s=w.movement.playerHeight/2,r=.03,c=.14,h=new Z(K,ue,s+.3);let d=!1,b=0,p=0,g=0;function C(){K.set(n.position.x,n.position.y+.05,n.position.z),h.length=s+.35;const u=t.pickWithRay(h,S=>S!==n&&S.checkCollisions===!0);if(!(u!=null&&u.hit)||!u.pickedPoint){d=!1;return}const M=n.position.y-s,A=u.pickedPoint.y;d=M-A<=c,d&&o.y<=0&&(o.y=0,n.position.y=A+s+r)}function f(u){b+=u;const M=t.activeCamera;if(!M)return;x.copyFrom(M.getForwardRay().direction),x.y=0,x.normalize(),a.CrossToRef(a.UpReadOnly,x,E),E.normalize(),L.setAll(0),i.keys.forward&&L.addInPlace(x),i.keys.back&&L.subtractInPlace(x),i.keys.left&&L.subtractInPlace(E),i.keys.right&&L.addInPlace(E);const A=L.lengthSquared()>0;A&&L.normalize();const v=i.keys.sprint?w.movement.sprintSpeed:w.movement.walkSpeed,S=A?L.x*v:0,q=A?L.z*v:0;let G=A?w.movement.acceleration:w.movement.deceleration;!d&&A&&(G=w.movement.airAcceleration);const N=Math.min(1,G*u);o.x+=(S-o.x)*N,o.z+=(q-o.z)*N,C(),d?p=w.movement.coyoteTime:p=Math.max(0,p-u),i.consumeJumpPress()?g=w.movement.jumpBufferTime:g=Math.max(0,g-u),g>0&&(d||p>0)&&(o.y=w.movement.jumpSpeed,d=!1,p=0,g=0);let I=1;o.y<0?I=w.movement.fallGravityMultiplier:o.y>0&&!i.keys.jump&&(I=w.movement.lowJumpGravityMultiplier),o.y+=w.movement.gravity*I*u,Y.set(o.x*u,o.y*u,o.z*u),n.moveWithCollisions(Y),C();const W=Math.hypot(o.x,o.z),$=W/w.movement.sprintSpeed,J=d?W>.35?"run":"idle":"jump";if(l.setAnimationState(J),l.update(u,{elapsedTime:b,normalizedSpeed:$,isGrounded:d}),A){const H=Math.atan2(L.x,L.z),U=Math.min(1,w.movement.rotationLerp*u),X=Math.atan2(Math.sin(H-n.rotation.y),Math.cos(H-n.rotation.y));n.rotation.y+=X*U,_.set(Math.sin(n.rotation.y),0,Math.cos(n.rotation.y))}}return{mesh:n,update:f,getPosition:()=>n.position,setPosition:u=>{n.position.copyFrom(u),o.set(0,0,0),d=!1},isGrounded:()=>d,getFacingDirection:()=>_,getHorizontalSpeed:()=>Math.hypot(o.x,o.z),usesGlbCharacter:()=>l.loadedFromGlb}}function me(t){const e={forward:!1,back:!1,left:!1,right:!1,sprint:!1,jump:!1};let i=!1;const n=new Map([["KeyW","forward"],["KeyS","back"],["KeyA","left"],["KeyD","right"],["ShiftLeft","sprint"],["ShiftRight","sprint"]]);function l(){e.forward=!1,e.back=!1,e.left=!1,e.right=!1,e.sprint=!1,e.jump=!1,i=!1}function o(c){n.has(c.code)&&(e[n.get(c.code)]=!0),c.code==="Space"&&(c.repeat||(i=!0),e.jump=!0,c.preventDefault())}function s(c){n.has(c.code)&&(e[n.get(c.code)]=!1),c.code==="Space"&&(e.jump=!1,c.preventDefault())}function r(){l()}return window.addEventListener("keydown",o),window.addEventListener("keyup",s),window.addEventListener("blur",r),t.setAttribute("tabindex","0"),{keys:e,consumeJumpPress(){const c=i;return i=!1,c},dispose(){window.removeEventListener("keydown",o),window.removeEventListener("keyup",s),window.removeEventListener("blur",r),l()}}}function fe(t,e,i){const n=w.camera,l=new a,o=new a,s=new ee("playerCamera",Math.PI*1.4,1.1,n.distance,i.getPosition(),t);s.attachControl(e,!0),s.lowerBetaLimit=n.pitchMin+Math.PI/2,s.upperBetaLimit=n.pitchMax+Math.PI/2,s.lowerRadiusLimit=n.minDistance,s.upperRadiusLimit=n.maxDistance,s.wheelDeltaPercentage=.01,s.angularSensibilityX=1/n.mouseSensitivity,s.angularSensibilityY=1/n.mouseSensitivity,s.inertia=n.inertia,s.checkCollisions=!0,s.collisionRadius=new a(n.collisionRadius,n.collisionRadius,n.collisionRadius),t.activeCamera=s;function r(){var h;document.pointerLockElement!==e&&((h=e.requestPointerLock)==null||h.call(e))}function c(h){const d=i.getPosition(),b=i.getFacingDirection();o.set(b.x*n.lookAheadDistance,0,b.z*n.lookAheadDistance);const p=Math.min(1,n.lookAheadLerp*h);if(l.x+=(d.x+o.x-l.x)*p,l.z+=(d.z+o.z-l.z)*p,l.y=d.y+n.heightOffset,i.getHorizontalSpeed()>n.cameraRotationMoveThreshold){const C=d?i.mesh.rotation.y+Math.PI:s.alpha,f=Math.atan2(Math.sin(C-s.alpha),Math.cos(C-s.alpha)),u=Math.min(1,n.cameraRotationFollowLerp*h);s.alpha+=f*u}const g=Math.min(1,n.followLerp*h);s.target=a.Lerp(s.target,l,g)}return{camera:s,activatePointerLock:r,update:c}}function we(){const t=document.getElementById("startScreen"),e=document.getElementById("playButton"),i=document.getElementById("hud"),n=document.getElementById("objectiveText"),l=document.getElementById("storyBox"),o=document.getElementById("interactPrompt");let s=!1,r=!1;function c(f){s||(s=!0,setTimeout(()=>{t.classList.remove("visible"),i.classList.remove("hidden"),f==null||f()},120))}function h(f){e.addEventListener("click",()=>c(f))}function d(f){l.textContent=f,l.classList.remove("hidden")}function b(f){n.textContent=`Objective: ${f}`}function p(f){o.textContent=f,o.classList.remove("hidden")}function g(){o.classList.add("hidden")}function C(f){f.code==="KeyE"&&!f.repeat&&(r=!0)}return window.addEventListener("keydown",C),{bindStart:h,showStory:d,setObjective:b,showInteractPrompt:p,hideInteractPrompt:g,consumeInteractPressed(){const f=r;return r=!1,f},isPlaying:()=>s,dispose(){window.removeEventListener("keydown",C)}}}function ge(t,e,i){let n=!1,l=!1,o=e.getPosition().clone(),s=0,r=!1,c=()=>{};function h(p){c=p}function d(p){s>0&&(s=Math.max(0,s-p));const g=e.getPosition();n||a.Distance(g,t.shrinePosition)<=w.world.shrineTriggerRadius&&(n=!0,o=t.shrinePosition.clone(),o.y=g.y,i.showStory("A distant bell rings. Something calls you beyond the monastery."),i.setObjective("Find the sealed gate"),c()),!l&&t.gatePosition&&a.Distance(g,t.gatePosition)<=w.world.gateTriggerRadius&&(l=!0,o=t.gatePosition.clone(),o.y=g.y,i.showStory("Beyond the gate, mountain winds carry distant chanting. The world is waiting."),i.setObjective("Offer incense (E) and continue your journey")),r&&s<=0&&(r=!1,s=w.world.checkpointResetCooldown,e.setPosition(o),i.showStory("You center your breath and return to your last point of calm."),i.showInteractPrompt("Checkpoint restored"),window.setTimeout(()=>{i.hideInteractPrompt()},900))}function b(p){p.code==="KeyR"&&!p.repeat&&(r=!0)}return window.addEventListener("keydown",b),{update:d,setOnShrineTriggered:h,isShrineTriggered:()=>n,isGateTriggered:()=>l,dispose(){window.removeEventListener("keydown",b)}}}function O(t,e){return t+Math.random()*(e-t)}function ye(t){const e=w.effects.dustMotes,i=[],n=new T("dustMoteMaterial",t);n.diffuseColor=new k(.95,.89,.75),n.emissiveColor=new k(.12,.1,.06),n.alpha=.5,n.disableLighting=!0;for(let o=0;o<e.count;o+=1){const s=P.CreateSphere(`dustMote${o}`,{diameter:e.size,segments:6},t),r=new a(O(-20,e.radius),O(e.minHeight,e.maxHeight),O(-20,e.radius));s.position.copyFrom(r),s.material=n,s.isPickable=!1,s.checkCollisions=!1,i.push({mesh:s,basePos:r,phase:Math.random()*Math.PI*2,driftDir:new a(O(-1,1),0,O(-1,1)).normalize()})}function l(o){const s=performance.now()*.001;for(const r of i)r.mesh.position.x+=r.driftDir.x*e.driftSpeed*o,r.mesh.position.z+=r.driftDir.z*e.driftSpeed*o,r.mesh.position.y=r.basePos.y+Math.sin(s+r.phase)*e.bobAmplitude,Math.abs(r.mesh.position.x)>e.radius&&(r.mesh.position.x=-r.mesh.position.x*.9),Math.abs(r.mesh.position.z)>e.radius&&(r.mesh.position.z=-r.mesh.position.z*.9)}return{update:l}}function be(){let t,e,i,n=!1;function l(){t||(t=new window.AudioContext),t.state==="suspended"&&t.resume()}function o(){if(n)return;l(),e=t.createOscillator(),i=t.createGain();const r=t.createBiquadFilter();e.type="triangle",e.frequency.value=110,r.type="lowpass",r.frequency.value=320,r.Q.value=.4,i.gain.value=w.audio.ambientVolume,e.connect(r),r.connect(i),i.connect(t.destination),e.start(),n=!0}function s(){if(!n)return;const r=t.currentTime,c=t.createGain(),h=t.createOscillator(),d=t.createOscillator();h.type="sine",d.type="sine",h.frequency.setValueAtTime(784,r),d.frequency.setValueAtTime(1176,r),c.gain.setValueAtTime(w.audio.bellVolume,r),c.gain.exponentialRampToValueAtTime(.001,r+2.1),h.connect(c),d.connect(c),c.connect(t.destination),h.start(r),d.start(r+.01),h.stop(r+2.2),d.stop(r+2.2)}return{start:o,playShrineBell:s}}const Ce=new a(0,1,0);function Me(t,e,i){let n=!1;function l(){if(!t.interactablePosition||n)return;const o=e.getPosition();if(a.Distance(o,t.interactablePosition)>w.world.interactRange){i.hideInteractPrompt();return}i.showInteractPrompt("Press E to light incense"),i.consumeInteractPressed()&&(n=!0,i.hideInteractPrompt(),i.showStory("You light the incense bowl. Smoke curls upward, and the silence deepens."),t.interactableFlame&&(t.interactableFlame.isVisible=!0,t.interactableFlame.position.copyFrom(t.interactablePosition).addInPlace(Ce)))}return{update:l,isCompleted:()=>n}}function Ae(){const t=document.createElement("div");return t.style.position="fixed",t.style.right="12px",t.style.top="10px",t.style.padding="4px 8px",t.style.fontSize="12px",t.style.background="rgba(0,0,0,0.4)",t.style.border="1px solid rgba(255,255,255,0.15)",t.style.borderRadius="4px",t.style.color="#d8dde9",t.style.pointerEvents="none",t.textContent="FPS: --",document.body.appendChild(t),{update(e){t.textContent=`FPS: ${Math.round(e)}`}}}function ke(){const{canvas:t,engine:e,scene:i}=ie();i.clearColor.set(.56,.62,.72,1);const n=new te("hemiLight",new a(0,1,0),i);n.intensity=.68,n.groundColor=new k(.26,.22,.16);const l=new ne("sunLight",new a(-.4,-1,.35),i);l.intensity=1.6,l.position=new a(15,30,-10);const o=oe(i),s=me(t),r=pe(i,o,s),c=fe(i,t,r),h=we(),d=ge(o,r,h),b=ye(i),p=be(),g=Me(o,r,h),C=Ae();h.bindStart(()=>{t.focus(),c.activatePointerLock(),p.start()}),d.setOnShrineTriggered(()=>{p.playShrineBell()}),i.onBeforeRenderObservable.add(()=>{if(!h.isPlaying())return;const M=i.getEngine().getDeltaTime()/1e3;r.update(M),c.update(M),b.update(M),d.update(M),g.update(M),C.update(i.getEngine().getFps())}),e.runRenderLoop(()=>{i.render()}),window.addEventListener("resize",()=>{e.resize()});let f=!1;const u=()=>{var M,A,v;f||(f=!0,(M=s.dispose)==null||M.call(s),(A=d.dispose)==null||A.call(d),(v=h.dispose)==null||v.call(h))};i.onDisposeObservable.add(u),window.addEventListener("beforeunload",u,{once:!0})}export{ke as createGame};

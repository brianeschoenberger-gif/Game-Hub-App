import{E,S as O,a as S,C as y,M as k,V as s,R as F,A as I,H as T,D as G}from"./babylon-core-ykpjuxbh.js";function A(){const e=document.getElementById("renderCanvas");if(!e)throw new Error("Render canvas not found.");const t={preserveDrawingBuffer:!0,stencil:!0};let n;try{n=new E(e,!0,{...t,disableWebGL2Support:!1})}catch{n=new E(e,!0,{...t,disableWebGL2Support:!0})}const o=new O(n);return{canvas:e,engine:n,scene:o}}function w(e,t,n,o,r){const i=k.CreateBox(t,n,e);return i.position=o,i.material=r,i.checkCollisions=!0,i}function H(e){e.collisionsEnabled=!0;const t=new S("stoneMaterial",e);t.diffuseColor=new y(.57,.55,.52);const n=new S("woodMaterial",e);n.diffuseColor=new y(.46,.34,.23);const o=new S("clothMaterial",e);o.diffuseColor=new y(.69,.61,.48);const r=k.CreateGround("ground",{width:42,height:42},e);r.material=t,r.checkCollisions=!0,w(e,"cellFloor",{width:8,depth:6,height:.5},new s(-10,.25,0),t),w(e,"hallFloor",{width:12,depth:5,height:.5},new s(-3.5,.25,0),t),w(e,"courtyardFloor",{width:20,depth:14,height:.5},new s(7,.25,0),t),w(e,"shrineFloor",{width:6,depth:6,height:.5},new s(14,.25,0),t),[{name:"cellWallWest",size:{width:.6,height:3,depth:6},pos:new s(-14,1.5,0)},{name:"cellWallNorth",size:{width:8.6,height:3,depth:.6},pos:new s(-10,1.5,-3.3)},{name:"cellWallSouth",size:{width:8.6,height:3,depth:.6},pos:new s(-10,1.5,3.3)},{name:"hallWallNorth",size:{width:12.2,height:3,depth:.6},pos:new s(-3.5,1.5,-2.8)},{name:"hallWallSouth",size:{width:12.2,height:3,depth:.6},pos:new s(-3.5,1.5,2.8)},{name:"courtyardWallNorth",size:{width:20.4,height:3,depth:.6},pos:new s(7,1.5,-7.2)},{name:"courtyardWallSouth",size:{width:20.4,height:3,depth:.6},pos:new s(7,1.5,7.2)},{name:"courtyardWallEast",size:{width:.6,height:3,depth:14.4},pos:new s(17.2,1.5,0)}].forEach(d=>{w(e,d.name,d.size,d.pos,t)}),w(e,"cellBed",{width:2.5,depth:1.2,height:.5},new s(-12,.7,1.2),n),w(e,"clothRoll",{width:1.7,depth:.7,height:.25},new s(-12,1.08,1.2),o),w(e,"altarBase",{width:2.2,depth:1.4,height:1.1},new s(14,.8,0),n);const l=w(e,"shrineMarker",{width:.9,depth:.9,height:2.1},new s(14,1.8,0),o);return l.isPickable=!1,{ground:r,shrinePosition:l.position.clone()}}const m={movement:{walkSpeed:6,sprintSpeed:9.5,acceleration:28,deceleration:20,jumpSpeed:7.2,gravity:-18,rotationLerp:10,playerHeight:1.8,spawnPosition:{x:-6.5,y:1.1,z:0}},camera:{distance:4.5,minDistance:2.2,maxDistance:7.5,heightOffset:2.2,mouseSensitivity:.0018,pitchMin:-.7,pitchMax:.95,followLerp:14},world:{shrineTriggerRadius:2.4}};function K(e){const t=new S("monkSkinMaterial",e);t.diffuseColor=new y(.86,.73,.58);const n=new S("monkRobeMaterial",e);n.diffuseColor=new y(.71,.42,.2);const o=new S("monkSashMaterial",e);return o.diffuseColor=new y(.6,.22,.18),{skinMaterial:t,robeMaterial:n,sashMaterial:o}}function V(e,t){const{skinMaterial:n,robeMaterial:o,sashMaterial:r}=K(t),i=k.CreateCylinder("monkRobe",{height:1.05,diameterTop:.44,diameterBottom:.72,tessellation:12},t);i.material=o,i.parent=e,i.position=new s(0,-.16,0);const l=k.CreateSphere("monkHead",{diameter:.44,segments:16},t);l.material=n,l.parent=e,l.position=new s(0,.67,0);const d=k.CreateTorus("monkSash",{diameter:.48,thickness:.08,tessellation:18},t);d.material=r,d.parent=e,d.position=new s(0,.09,0),d.rotation.x=Math.PI/2}function Y(e){const t=k.CreateCapsule("playerCapsule",{radius:.45,height:1.8,tessellation:12},e);t.isVisible=!1,t.ellipsoid=new s(.45,.9,.45),t.ellipsoidOffset=new s(0,.9,0),t.checkCollisions=!0;const n=m.movement.spawnPosition;return t.position=new s(n.x,n.y,n.z),V(t,e),t}const b=new s,M=new s,f=new s,z=new s,R=new s,J=new s(0,-1,0);function N(e,t,n){const o=Y(e),r=new s(0,0,0),i=m.movement.playerHeight/2,l=.03,d=.14,a=new F(R,J,i+.3);let c=!1;function h(){R.set(o.position.x,o.position.y+.05,o.position.z),a.length=i+.35;const u=e.pickWithRay(a,v=>v!==o&&v.checkCollisions===!0);if(!(u!=null&&u.hit)||!u.pickedPoint){c=!1;return}const g=o.position.y-i,p=u.pickedPoint.y;c=g-p<=d,c&&r.y<=0&&(r.y=0,o.position.y=p+i+l)}function C(u){const g=e.activeCamera;if(!g)return;b.copyFrom(g.getForwardRay().direction),b.y=0,b.normalize(),s.CrossToRef(s.UpReadOnly,b,M),M.normalize(),f.setAll(0),n.keys.forward&&f.addInPlace(b),n.keys.back&&f.subtractInPlace(b),n.keys.left&&f.subtractInPlace(M),n.keys.right&&f.addInPlace(M);const p=f.lengthSquared()>0;p&&f.normalize();const P=n.keys.sprint?m.movement.sprintSpeed:m.movement.walkSpeed,v=p?f.x*P:0,D=p?f.z*P:0,B=p?m.movement.acceleration:m.movement.deceleration,x=Math.min(1,B*u);if(r.x+=(v-r.x)*x,r.z+=(D-r.z)*x,h(),c&&n.consumeJumpPress()&&(r.y=m.movement.jumpSpeed,c=!1),r.y+=m.movement.gravity*u,z.set(r.x*u,r.y*u,r.z*u),o.moveWithCollisions(z),h(),p){const L=Math.atan2(f.x,f.z),W=Math.min(1,m.movement.rotationLerp*u),j=Math.atan2(Math.sin(L-o.rotation.y),Math.cos(L-o.rotation.y));o.rotation.y+=j*W}}return{mesh:o,update:C,getPosition:()=>o.position,isGrounded:()=>c}}function U(e){const t={forward:!1,back:!1,left:!1,right:!1,sprint:!1,jump:!1};let n=!1;const o=new Map([["KeyW","forward"],["KeyS","back"],["KeyA","left"],["KeyD","right"],["ShiftLeft","sprint"],["ShiftRight","sprint"]]);function r(){t.forward=!1,t.back=!1,t.left=!1,t.right=!1,t.sprint=!1,t.jump=!1,n=!1}function i(a){o.has(a.code)&&(t[o.get(a.code)]=!0),a.code==="Space"&&(a.repeat||(n=!0),t.jump=!0,a.preventDefault())}function l(a){o.has(a.code)&&(t[o.get(a.code)]=!1),a.code==="Space"&&(t.jump=!1,a.preventDefault())}function d(){r()}return window.addEventListener("keydown",i),window.addEventListener("keyup",l),window.addEventListener("blur",d),e.setAttribute("tabindex","0"),{keys:t,consumeJumpPress(){const a=n;return n=!1,a},dispose(){window.removeEventListener("keydown",i),window.removeEventListener("keyup",l),window.removeEventListener("blur",d),r()}}}function q(e,t,n){const o=m.camera,r=new s,i=new I("playerCamera",Math.PI*1.4,1.1,o.distance,n.getPosition(),e);i.attachControl(t,!0),i.lowerBetaLimit=o.pitchMin+Math.PI/2,i.upperBetaLimit=o.pitchMax+Math.PI/2,i.lowerRadiusLimit=o.minDistance,i.upperRadiusLimit=o.maxDistance,i.wheelDeltaPercentage=.01,i.angularSensibilityX=1/o.mouseSensitivity,i.angularSensibilityY=1/o.mouseSensitivity,i.checkCollisions=!0,i.collisionRadius=new s(.4,.4,.4),e.activeCamera=i;function l(){var a;document.pointerLockElement!==t&&((a=t.requestPointerLock)==null||a.call(t))}function d(a){const c=n.getPosition();r.set(c.x,c.y+o.heightOffset,c.z);const h=Math.min(1,o.followLerp*a);i.target=s.Lerp(i.target,r,h)}return{camera:i,activatePointerLock:l,update:d}}function X(){const e=document.getElementById("startScreen"),t=document.getElementById("playButton"),n=document.getElementById("hud"),o=document.getElementById("objectiveText"),r=document.getElementById("storyBox");let i=!1;function l(h){i||(i=!0,setTimeout(()=>{e.classList.remove("visible"),n.classList.remove("hidden"),h==null||h()},120))}function d(h){t.addEventListener("click",()=>l(h))}function a(h){r.textContent=h,r.classList.remove("hidden")}function c(h){o.textContent=`Objective: ${h}`}return{bindStart:d,showStory:a,setObjective:c,isPlaying:()=>i}}function $(e,t,n){let o=!1;function r(){if(o)return;const i=t.getPosition();s.Distance(i,e.shrinePosition)<=m.world.shrineTriggerRadius&&(o=!0,n.showStory("A distant bell rings. Something calls you beyond the monastery."),n.setObjective("Prototype complete"))}return{update:r,isShrineTriggered:()=>o}}function Z(){const e=document.createElement("div");return e.style.position="fixed",e.style.right="12px",e.style.top="10px",e.style.padding="4px 8px",e.style.fontSize="12px",e.style.background="rgba(0,0,0,0.4)",e.style.border="1px solid rgba(255,255,255,0.15)",e.style.borderRadius="4px",e.style.color="#d8dde9",e.style.pointerEvents="none",e.textContent="FPS: --",document.body.appendChild(e),{update(t){e.textContent=`FPS: ${Math.round(t)}`}}}function _(){const{canvas:e,engine:t,scene:n}=A();n.clearColor.set(.56,.62,.72,1);const o=new T("hemiLight",new s(0,1,0),n);o.intensity=.68,o.groundColor=new y(.26,.22,.16);const r=new G("sunLight",new s(-.4,-1,.35),n);r.intensity=1.6,r.position=new s(15,30,-10);const i=H(n),l=U(e),d=N(n,i,l),a=q(n,e,d),c=X(),h=$(i,d,c),C=Z();c.bindStart(()=>{e.focus(),a.activatePointerLock()}),n.onBeforeRenderObservable.add(()=>{if(!c.isPlaying())return;const p=n.getEngine().getDeltaTime()/1e3;d.update(p),a.update(p),h.update(),C.update(n.getEngine().getFps())}),t.runRenderLoop(()=>{n.render()}),window.addEventListener("resize",()=>{t.resize()});let u=!1;const g=()=>{var p;u||(u=!0,(p=l.dispose)==null||p.call(l))};n.onDisposeObservable.add(g),window.addEventListener("beforeunload",g,{once:!0})}export{_ as createGame};

import{E as O,S as I,a as b,C as y,M as S,V as n,R as q,A as $,H as K,D as J}from"./babylon-core-ykpjuxbh.js";function Y(){const t=document.getElementById("renderCanvas");if(!t)throw new Error("Render canvas not found.");const e={preserveDrawingBuffer:!0,stencil:!0};let o;try{o=new O(t,!0,{...e,disableWebGL2Support:!1})}catch{o=new O(t,!0,{...e,disableWebGL2Support:!0})}const i=new I(o);return{canvas:t,engine:o,scene:i}}function u(t,e,o,i,r){const h=S.CreateBox(e,o,t);return h.position=i,h.material=r,h.checkCollisions=!0,h}function A(t,e,o){e.forEach(i=>{u(t,i.name,i.size,i.pos,o)})}function B(t,e,o){const h=e.width/2,s=e.depth/2;A(t,[{name:`${e.name}WallNorth`,size:{width:e.width+.6,height:3,depth:.6},pos:new n(e.center.x,3/2,e.center.z-s)},{name:`${e.name}WallSouth`,size:{width:e.width+.6,height:3,depth:.6},pos:new n(e.center.x,3/2,e.center.z+s)},{name:`${e.name}WallWest`,size:{width:.6,height:3,depth:e.depth+.6},pos:new n(e.center.x-h,3/2,e.center.z)},{name:`${e.name}WallEast`,size:{width:.6,height:3,depth:e.depth+.6},pos:new n(e.center.x+h,3/2,e.center.z)}],o)}function N(t){t.collisionsEnabled=!0;const e=new b("stoneMaterial",t);e.diffuseColor=new y(.57,.55,.52);const o=new b("woodMaterial",t);o.diffuseColor=new y(.46,.34,.23);const i=new b("clothMaterial",t);i.diffuseColor=new y(.69,.61,.48);const r=new b("gardenMaterial",t);r.diffuseColor=new y(.35,.43,.33);const h=new b("waterMaterial",t);h.diffuseColor=new y(.35,.53,.62);const s=S.CreateGround("ground",{width:78,height:58},t);s.material=e,s.checkCollisions=!0,B(t,{name:"northCellA",center:new n(-30,0,-13),width:8,depth:8},e),B(t,{name:"northCellB",center:new n(-21,0,-13),width:8,depth:8},e),B(t,{name:"kitchen",center:new n(-30,0,2),width:8,depth:8},e),B(t,{name:"startCell",center:new n(-21,0,2),width:8,depth:8},e);const a=u(t,"courtyardFloor",{width:31,depth:26,height:.5},new n(-1,.25,-4),r);a.checkCollisions=!1,u(t,"northArchWall",{width:15,depth:.6,height:4},new n(-1,2,-17),e),u(t,"northArchPillarLeft",{width:.9,depth:.9,height:4},new n(-8.2,2,-17),e),u(t,"northArchPillarRight",{width:.9,depth:.9,height:4},new n(6.2,2,-17),e),u(t,"bookshelfUpper",{width:14,depth:.8,height:1.6},new n(-14.5,.8,-17),o),u(t,"bookshelfLower",{width:14,depth:.8,height:1.6},new n(-14.5,.8,6),o),u(t,"northBedAFrame",{width:2.5,depth:1.4,height:.55},new n(-31,.72,-14.8),o),u(t,"northBedAMat",{width:1.8,depth:1,height:.2},new n(-31,1.08,-14.8),i),u(t,"northBedBFrame",{width:2.5,depth:1.4,height:.55},new n(-22,.72,-14.8),o),u(t,"northBedBMat",{width:1.8,depth:1,height:.2},new n(-22,1.08,-14.8),i),u(t,"startBedFrame",{width:2.5,depth:1.4,height:.55},new n(-22,.72,3.8),o),u(t,"startBedMat",{width:1.8,depth:1,height:.2},new n(-22,1.08,3.8),i),u(t,"statueBase",{width:3,depth:2,height:1},new n(-7,.6,-4),e);const l=u(t,"shrineMarker",{width:.9,depth:.9,height:2.2},new n(-7,1.8,-4),i);l.isPickable=!1;const d=S.CreateCylinder("fountain",{height:.9,diameter:6,tessellation:28},t);d.position=new n(4.5,.45,-4),d.material=h,d.checkCollisions=!0;const c=[{name:"eastTopOuterNorth",size:{width:16,height:3,depth:.6},pos:new n(23,1.5,-17)},{name:"eastTopOuterSouth",size:{width:16,height:3,depth:.6},pos:new n(23,1.5,-6.5)},{name:"eastTopOuterEast",size:{width:.6,height:3,depth:10.5},pos:new n(31,1.5,-11.8)},{name:"eastTopOuterWestA",size:{width:.6,height:3,depth:4},pos:new n(15,1.5,-15)},{name:"eastTopOuterWestB",size:{width:.6,height:3,depth:4.5},pos:new n(15,1.5,-8.8)},{name:"eastTopMazeA",size:{width:6,height:3,depth:.6},pos:new n(20,1.5,-13.2)},{name:"eastTopMazeB",size:{width:.6,height:3,depth:5},pos:new n(24,1.5,-14.5)},{name:"eastTopMazeC",size:{width:4.2,height:3,depth:.6},pos:new n(26.8,1.5,-10.6)},{name:"eastTopMazeD",size:{width:.6,height:3,depth:4},pos:new n(19.2,1.5,-9.5)}];A(t,c,e);const f=[{name:"eastBottomOuterNorth",size:{width:16,height:3,depth:.6},pos:new n(23,1.5,6.5)},{name:"eastBottomOuterSouth",size:{width:16,height:3,depth:.6},pos:new n(23,1.5,22)},{name:"eastBottomOuterWest",size:{width:.6,height:3,depth:15.5},pos:new n(15,1.5,14.2)},{name:"eastBottomOuterEastA",size:{width:.6,height:3,depth:5.5},pos:new n(31,1.5,9.2)},{name:"eastBottomOuterEastB",size:{width:.6,height:3,depth:8},pos:new n(31,1.5,18)},{name:"eastBottomMazeA",size:{width:9.6,height:3,depth:.6},pos:new n(21.4,1.5,11.5)},{name:"eastBottomMazeB",size:{width:.6,height:3,depth:7},pos:new n(19,1.5,16.8)},{name:"eastBottomMazeC",size:{width:4.5,height:3,depth:.6},pos:new n(27.7,1.5,14.6)},{name:"eastBottomMazeD",size:{width:.6,height:3,depth:6},pos:new n(26,1.5,18.9)}];return A(t,f,e),u(t,"southBlockWest",{width:17,depth:11,height:3},new n(-13,1.5,18),e),u(t,"southBlockCenter",{width:10,depth:11,height:3},new n(2.5,1.5,18),e),u(t,"mapBoundaryWest",{width:.6,depth:48,height:3},new n(-34.8,1.5,3),e),u(t,"mapBoundaryNorth",{width:48,depth:.6,height:3},new n(-10.5,1.5,-20.5),e),u(t,"mapBoundarySouth",{width:66,depth:.6,height:3},new n(-2,1.5,24.2),e),{ground:s,shrinePosition:l.position.clone()}}const w={movement:{walkSpeed:5.8,sprintSpeed:8.8,acceleration:24,deceleration:16,airAcceleration:7,jumpSpeed:7.6,gravity:-19,fallGravityMultiplier:1.22,lowJumpGravityMultiplier:1.1,coyoteTime:.08,jumpBufferTime:.12,rotationLerp:11,playerHeight:1.8,spawnPosition:{x:-22,y:1.1,z:1.8}},camera:{distance:3.4,minDistance:1.7,maxDistance:6.5,heightOffset:2.2,mouseSensitivity:.0011,pitchMin:-.7,pitchMax:.95,followLerp:12,lookAheadDistance:.9,lookAheadLerp:6,cameraRotationFollowLerp:5,cameraRotationMoveThreshold:.25,collisionRadius:.34,inertia:.62},effects:{dustMotes:{count:24,radius:20,minHeight:.7,maxHeight:3.4,driftSpeed:.18,bobAmplitude:.14,size:.055}},audio:{ambientVolume:.06,bellVolume:.2},world:{shrineTriggerRadius:2.4}};function U(t){const e=new b("monkSkinMaterial",t);e.diffuseColor=new y(.86,.73,.58);const o=new b("monkRobeMaterial",t);o.diffuseColor=new y(.71,.42,.2);const i=new b("monkSashMaterial",t);return i.diffuseColor=new y(.6,.22,.18),{skinMaterial:e,robeMaterial:o,sashMaterial:i}}function X(t,e){const{skinMaterial:o,robeMaterial:i,sashMaterial:r}=U(e),h=S.CreateCylinder("monkRobe",{height:1.05,diameterTop:.44,diameterBottom:.72,tessellation:12},e);h.material=i,h.parent=t,h.position=new n(0,-.16,0);const s=S.CreateSphere("monkHead",{diameter:.44,segments:16},e);s.material=o,s.parent=t,s.position=new n(0,.67,0);const a=S.CreateTorus("monkSash",{diameter:.48,thickness:.08,tessellation:18},e);a.material=r,a.parent=t,a.position=new n(0,.09,0),a.rotation.x=Math.PI/2}function Q(t){const e=S.CreateCapsule("playerCapsule",{radius:.45,height:1.8,tessellation:12},t);e.isVisible=!1,e.ellipsoid=new n(.45,.9,.45),e.ellipsoidOffset=new n(0,.9,0),e.checkCollisions=!0;const o=w.movement.spawnPosition;return e.position=new n(o.x,o.y,o.z),X(e,t),e}const z=new n,P=new n,g=new n,H=new n,W=new n,Z=new n(0,-1,0),F=new n(0,0,1);function _(t,e,o){const i=Q(t),r=new n(0,0,0),h=w.movement.playerHeight/2,s=.03,a=.14,l=new q(W,Z,h+.3);let d=!1,c=0,f=0;function k(){W.set(i.position.x,i.position.y+.05,i.position.z),l.length=h+.35;const p=t.pickWithRay(l,C=>C!==i&&C.checkCollisions===!0);if(!(p!=null&&p.hit)||!p.pickedPoint){d=!1;return}const M=i.position.y-h,m=p.pickedPoint.y;d=M-m<=a,d&&r.y<=0&&(r.y=0,i.position.y=m+h+s)}function v(p){const M=t.activeCamera;if(!M)return;z.copyFrom(M.getForwardRay().direction),z.y=0,z.normalize(),n.CrossToRef(n.UpReadOnly,z,P),P.normalize(),g.setAll(0),o.keys.forward&&g.addInPlace(z),o.keys.back&&g.subtractInPlace(z),o.keys.left&&g.subtractInPlace(P),o.keys.right&&g.addInPlace(P);const m=g.lengthSquared()>0;m&&g.normalize();const T=o.keys.sprint?w.movement.sprintSpeed:w.movement.walkSpeed,C=m?g.x*T:0,j=m?g.z*T:0;let R=m?w.movement.acceleration:w.movement.deceleration;!d&&m&&(R=w.movement.airAcceleration);const D=Math.min(1,R*p);r.x+=(C-r.x)*D,r.z+=(j-r.z)*D,k(),d?c=w.movement.coyoteTime:c=Math.max(0,c-p),o.consumeJumpPress()?f=w.movement.jumpBufferTime:f=Math.max(0,f-p),f>0&&(d||c>0)&&(r.y=w.movement.jumpSpeed,d=!1,c=0,f=0);let L=1;if(r.y<0?L=w.movement.fallGravityMultiplier:r.y>0&&!o.keys.jump&&(L=w.movement.lowJumpGravityMultiplier),r.y+=w.movement.gravity*L*p,H.set(r.x*p,r.y*p,r.z*p),i.moveWithCollisions(H),k(),m){const E=Math.atan2(g.x,g.z),G=Math.min(1,w.movement.rotationLerp*p),V=Math.atan2(Math.sin(E-i.rotation.y),Math.cos(E-i.rotation.y));i.rotation.y+=V*G,F.set(Math.sin(i.rotation.y),0,Math.cos(i.rotation.y))}}return{mesh:i,update:v,getPosition:()=>i.position,isGrounded:()=>d,getFacingDirection:()=>F,getHorizontalSpeed:()=>Math.hypot(r.x,r.z)}}function ee(t){const e={forward:!1,back:!1,left:!1,right:!1,sprint:!1,jump:!1};let o=!1;const i=new Map([["KeyW","forward"],["KeyS","back"],["KeyA","left"],["KeyD","right"],["ShiftLeft","sprint"],["ShiftRight","sprint"]]);function r(){e.forward=!1,e.back=!1,e.left=!1,e.right=!1,e.sprint=!1,e.jump=!1,o=!1}function h(l){i.has(l.code)&&(e[i.get(l.code)]=!0),l.code==="Space"&&(l.repeat||(o=!0),e.jump=!0,l.preventDefault())}function s(l){i.has(l.code)&&(e[i.get(l.code)]=!1),l.code==="Space"&&(e.jump=!1,l.preventDefault())}function a(){r()}return window.addEventListener("keydown",h),window.addEventListener("keyup",s),window.addEventListener("blur",a),t.setAttribute("tabindex","0"),{keys:e,consumeJumpPress(){const l=o;return o=!1,l},dispose(){window.removeEventListener("keydown",h),window.removeEventListener("keyup",s),window.removeEventListener("blur",a),r()}}}function te(t,e,o){const i=w.camera,r=new n,h=new n,s=new $("playerCamera",Math.PI*1.4,1.1,i.distance,o.getPosition(),t);s.attachControl(e,!0),s.lowerBetaLimit=i.pitchMin+Math.PI/2,s.upperBetaLimit=i.pitchMax+Math.PI/2,s.lowerRadiusLimit=i.minDistance,s.upperRadiusLimit=i.maxDistance,s.wheelDeltaPercentage=.01,s.angularSensibilityX=1/i.mouseSensitivity,s.angularSensibilityY=1/i.mouseSensitivity,s.inertia=i.inertia,s.checkCollisions=!0,s.collisionRadius=new n(i.collisionRadius,i.collisionRadius,i.collisionRadius),t.activeCamera=s;function a(){var d;document.pointerLockElement!==e&&((d=e.requestPointerLock)==null||d.call(e))}function l(d){const c=o.getPosition(),f=o.getFacingDirection();h.set(f.x*i.lookAheadDistance,0,f.z*i.lookAheadDistance);const k=Math.min(1,i.lookAheadLerp*d);if(r.x+=(c.x+h.x-r.x)*k,r.z+=(c.z+h.z-r.z)*k,r.y=c.y+i.heightOffset,o.getHorizontalSpeed()>i.cameraRotationMoveThreshold){const p=c?o.mesh.rotation.y+Math.PI:s.alpha,M=Math.atan2(Math.sin(p-s.alpha),Math.cos(p-s.alpha)),m=Math.min(1,i.cameraRotationFollowLerp*d);s.alpha+=M*m}const v=Math.min(1,i.followLerp*d);s.target=n.Lerp(s.target,r,v)}return{camera:s,activatePointerLock:a,update:l}}function ie(){const t=document.getElementById("startScreen"),e=document.getElementById("playButton"),o=document.getElementById("hud"),i=document.getElementById("objectiveText"),r=document.getElementById("storyBox");let h=!1;function s(c){h||(h=!0,setTimeout(()=>{t.classList.remove("visible"),o.classList.remove("hidden"),c==null||c()},120))}function a(c){e.addEventListener("click",()=>s(c))}function l(c){r.textContent=c,r.classList.remove("hidden")}function d(c){i.textContent=`Objective: ${c}`}return{bindStart:a,showStory:l,setObjective:d,isPlaying:()=>h}}function ne(t,e,o){let i=!1,r=()=>{};function h(a){r=a}function s(){if(i)return;const a=e.getPosition();n.Distance(a,t.shrinePosition)<=w.world.shrineTriggerRadius&&(i=!0,o.showStory("A distant bell rings. Something calls you beyond the monastery."),o.setObjective("Prototype complete"),r())}return{update:s,setOnShrineTriggered:h,isShrineTriggered:()=>i}}function x(t,e){return t+Math.random()*(e-t)}function oe(t){const e=w.effects.dustMotes,o=[],i=new b("dustMoteMaterial",t);i.diffuseColor=new y(.95,.89,.75),i.emissiveColor=new y(.12,.1,.06),i.alpha=.5,i.disableLighting=!0;for(let h=0;h<e.count;h+=1){const s=S.CreateSphere(`dustMote${h}`,{diameter:e.size,segments:6},t),a=new n(x(-20,e.radius),x(e.minHeight,e.maxHeight),x(-20,e.radius));s.position.copyFrom(a),s.material=i,s.isPickable=!1,s.checkCollisions=!1,o.push({mesh:s,basePos:a,phase:Math.random()*Math.PI*2,driftDir:new n(x(-1,1),0,x(-1,1)).normalize()})}function r(h){const s=performance.now()*.001;for(const a of o)a.mesh.position.x+=a.driftDir.x*e.driftSpeed*h,a.mesh.position.z+=a.driftDir.z*e.driftSpeed*h,a.mesh.position.y=a.basePos.y+Math.sin(s+a.phase)*e.bobAmplitude,Math.abs(a.mesh.position.x)>e.radius&&(a.mesh.position.x=-a.mesh.position.x*.9),Math.abs(a.mesh.position.z)>e.radius&&(a.mesh.position.z=-a.mesh.position.z*.9)}return{update:r}}function ae(){let t,e,o,i=!1;function r(){t||(t=new window.AudioContext),t.state==="suspended"&&t.resume()}function h(){if(i)return;r(),e=t.createOscillator(),o=t.createGain();const a=t.createBiquadFilter();e.type="triangle",e.frequency.value=110,a.type="lowpass",a.frequency.value=320,a.Q.value=.4,o.gain.value=w.audio.ambientVolume,e.connect(a),a.connect(o),o.connect(t.destination),e.start(),i=!0}function s(){if(!i)return;const a=t.currentTime,l=t.createGain(),d=t.createOscillator(),c=t.createOscillator();d.type="sine",c.type="sine",d.frequency.setValueAtTime(784,a),c.frequency.setValueAtTime(1176,a),l.gain.setValueAtTime(w.audio.bellVolume,a),l.gain.exponentialRampToValueAtTime(.001,a+2.1),d.connect(l),c.connect(l),l.connect(t.destination),d.start(a),c.start(a+.01),d.stop(a+2.2),c.stop(a+2.2)}return{start:h,playShrineBell:s}}function se(){const t=document.createElement("div");return t.style.position="fixed",t.style.right="12px",t.style.top="10px",t.style.padding="4px 8px",t.style.fontSize="12px",t.style.background="rgba(0,0,0,0.4)",t.style.border="1px solid rgba(255,255,255,0.15)",t.style.borderRadius="4px",t.style.color="#d8dde9",t.style.pointerEvents="none",t.textContent="FPS: --",document.body.appendChild(t),{update(e){t.textContent=`FPS: ${Math.round(e)}`}}}function he(){const{canvas:t,engine:e,scene:o}=Y();o.clearColor.set(.56,.62,.72,1);const i=new K("hemiLight",new n(0,1,0),o);i.intensity=.68,i.groundColor=new y(.26,.22,.16);const r=new J("sunLight",new n(-.4,-1,.35),o);r.intensity=1.6,r.position=new n(15,30,-10);const h=N(o),s=ee(t),a=_(o,h,s),l=te(o,t,a),d=ie(),c=ne(h,a,d),f=oe(o),k=ae(),v=se();d.bindStart(()=>{t.focus(),l.activatePointerLock(),k.start()}),c.setOnShrineTriggered(()=>{k.playShrineBell()}),o.onBeforeRenderObservable.add(()=>{if(!d.isPlaying())return;const m=o.getEngine().getDeltaTime()/1e3;a.update(m),l.update(m),f.update(m),c.update(),v.update(o.getEngine().getFps())}),e.runRenderLoop(()=>{o.render()}),window.addEventListener("resize",()=>{e.resize()});let p=!1;const M=()=>{var m;p||(p=!0,(m=s.dispose)==null||m.call(s))};o.onDisposeObservable.add(M),window.addEventListener("beforeunload",M,{once:!0})}export{he as createGame};
